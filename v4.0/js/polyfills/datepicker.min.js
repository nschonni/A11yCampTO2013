/*
 * @title WET-BOEW Calendar library
 * @overview A library for building calendar interfaces
 * @license wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html
 * @author @pjackson28
 */
!function(a,b,c,d){"use strict";var e,f,g,h="input[type=date]",i=d.doc,j=new Date,k=j.getMonth(),l=j.getFullYear(),m="YYYY-MM-DD",n=!1,o=function(c){var i=c.target,j=i.id;if(c.currentTarget===i){if(b._timer.remove(h),-1!==i.className.indexOf("picker-field"))return;f||(e=b.i18n,f={datepickerShow:e("%date-show")+e("%space"),datepickerHide:e("%date-hide"),datepickerSelected:e("%date-sel")}),i.className+=" picker-field",g||(g=a("<div id='wb-picker' class='picker-overlay' role='dialog' aria-hidden='true'></div>"),a("<a class='picker-close' role='button' href='javascript:;'><img src='"+d.getPath("/assets")+"/cross-button.png' alt='"+f.datepickerHide+"' /></a>").appendTo(g).on("click",function(a){var b=a.which;b&&1!==b||s(g.attr("aria-controls"))}),g.find("a").attr("tabindex","-1"),a("body > main > div").after(g)),j&&p(j),n=!0}},p=function(b){var c=a("label[for="+b+"]").text(),e="<a id='"+b+"-picker-toggle' class='picker-toggle' href='javascript:;'><img src='"+d.getPath("/assets")+"/calendar-month.png' alt='"+f.datepickerShow+c+"'/></a>";a("#"+b).after(e),g.slideUp(0)},q=function(a,b,e,f,g){var h,i,j,k,l,m,n,o=c.getElementById(a),p=o.getAttribute("min"),q=o.getAttribute("max"),r=d.date.fromDateISO,s=f.length,t=g?g-1:0;for(p=r(p?p:"1800-01-01"),j=p.getDate()-1,q=r(q?q:"2100-01-01"),k=q.getDate(),h=b===p.getFullYear()&&e===p.getMonth(),i=b===q.getFullYear()&&e===q.getMonth(),l=0;l!==s;l+=1)(!h&&!i||h&&l>=j||i&&k>l)&&(m=f[l],m.innerHTML="<a href='javascript:;' tabindex='"+(l===t?"0":"-1")+"'>"+m.getElementsByTagName("div")[0].innerHTML+"</a>");g&&(n=f.find("a"),(1===g?n.first():n.last()).trigger("focus.wb"))},r=function(b,d,e,g){var h,i;a(g).removeClass("datepicker-selected").find(".datepicker-selected-text").detach(),h=c.getElementById(b).value;try{""!==h&&(i=new Date(h),i.getUTCFullYear()===d&&i.getUTCMonth()===e&&a(g[i.getUTCDate()-1]).addClass("datepicker-selected").children("a").attr("aria-selected","true").append("<span class='wb-inv datepicker-selected-text'> ["+f.datepickerSelected+"]</span>"))}catch(j){}},s=function(b){var e,h,j=c.getElementById(b),m=a(j),n=j.getAttribute("min"),o=j.getAttribute("max"),p=d.date.fromDateISO,q=p(j.value);n||(n="1800-01-01"),o||(o="2100-01-01"),g.attr({"aria-labelledby":b+"-picker-toggle","aria-controls":b}),i.trigger("create.wb-cal",["wb-picker",l,k,!0,n,o]),m.after(g),"false"!==g.attr("aria-hidden")?(t(b),g.slideDown("fast").attr("aria-hidden","false"),a("#"+b+"-picker-toggle").children("a").children("span").text(f.datepickerHide),null!==q?i.trigger("setFocus.wb-cal",["wb-picker",l,k,p(n),p(o),q.setDate(q.getDate()+1)]):(e=g.find(".cal-prvmnth"),e.hasClass("wb-inv")?(h=g.find(".cal-nxtmnth"),h.hasClass("wb-inv")?g.find(".cal-goto a").trigger("focus.wb"):h.trigger("focus.wb")):e.trigger("focus.wb"))):(u(b),m.trigger("focus.wb"))},t=function(b){var c,d,e=a(".picker-field").get(),f=e.length;for(c=0;c!==f;c+=1)d=e[c].id,d!==b&&u(d)},u=function(b){var c=a("#"+b+"-picker-toggle"),d=a("label[for="+b+"]").text();g.slideUp("fast").attr("aria-hidden","true").trigger("hideGoToFrm.wb-cal"),c.children("a").children("span").text(f.datepickerShow+d)},v=function(a,b,c,e){var f=d.string.pad;return e.replace("DD",f(c,2)).replace("D",c).replace("MM",f(b,2)).replace("M",b).replace("YYYY",a).replace("YY",a.toString().substr(2,2))};i.on("timerpoke.wb",h,o),i.on("click vclick touchstart focusin",function(b){var d,e=b.which;return!n||e&&1!==e||(d=c.getElementById("wb-picker"),"false"!==d.getAttribute("aria-hidden")||a.contains(d,b.target))?void 0:(u(d.getAttribute("aria-controls")),!1)}),i.on("keydown displayed.wb-cal","#wb-picker",function(b,c,d,e,f){var g=a(this),h=b.type,i=b.which,j=g.attr("aria-controls");switch(h){case"keydown":27===i&&(t(),a("#"+j).trigger("focus.wb"));break;case"displayed":q(j,c,d,e,f),r(j,c,d,e);break;case"click":case"vclick":case"touchstart":case"focusin":g.attr("aria-hidden")===!1&&(i&&1!==i||(b.stopPropagation?b.stopImmediatePropagation():b.cancelBubble=!0))}}),i.on("click",".picker-toggle",function(a){var b,c=a.which;return c&&1!==c?void 0:(b=this.id,s(b.substring(0,b.indexOf("-picker-toggle"))),!1)}),i.on("click",".cal-days a",function(b){var e,f,g,h,i,j,k=b.which;return k&&1!==k?void 0:(e=c.getElementById("wb-picker").getAttribute("aria-controls"),f=d.date.fromDateISO(this.getElementsByTagName("time")[0].getAttribute("datetime")),g=f.getFullYear(),h=f.getMonth(),i=f.getDate(),j=a("#"+e),j.val(v(g,h+1,i,m)),r(e,g,h,i),s(e),!1)}),b._timer.add(h)}(jQuery,window,document,vapour);