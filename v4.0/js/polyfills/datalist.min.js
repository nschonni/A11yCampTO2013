/*
 * @title WET-BOEW Datalist polyfill
 * @overview Adds auto-complete functionality to specific text input fields by dynamically displaying a list of words that match the user's input.
 * @license wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html
 * @author @pjackson28
 */
!function(a,b,c,d){"use strict";var e="input[list]",f=d.doc,g=!1,h=function(d){var f,h,i,j,k,l,m,n,o,p=d.target,q=p.id;if(d.currentTarget===p){for(f=a(p),h="<ul role='listbox' id='wb-al-"+p.id+"' class='wb-al hide' aria-hidden='true' aria-live='polite'></ul>",i=c.getElementById(p.getAttribute("list")),j=i.getElementsByTagName("option"),k=j.length,b._timer.remove(e),p.setAttribute("autocomplete","off"),p.setAttribute("role","textbox"),p.setAttribute("aria-haspopup","true"),p.setAttribute("aria-autocomplete","list"),p.setAttribute("aria-owns","wb-al-"+q),p.setAttribute("aria-activedescendent",""),h+="<ul id='wb-al-"+p.id+"-src' class='wb-al-src hide' aria-hidden='true'>",o=0;o!==k;o+=1)l=j[o],m=l.getAttribute("value"),n=l.getAttribute("label"),m||(m=l.innerHTML),h+="<li id='al-opt-"+q+"-"+o+"'><a href='javascript:;' tabindex='-1'><span class='al-val'>"+(m?m:"")+"</span><span class='al-lbl'>"+(n&&n!==m?n:"")+"</span></a></li>";f.after(h+"</ul>"),g=!0}},i=function(b,c){var d,e=a(b.nextSibling),f=e.next().children().clone();c&&0!==c.length&&(d=c.toLowerCase(),f=f.filter(function(){var b=a(this),c=b.find("span.al-val").html();return 0===c.length&&(c=b.find("span.al-lbl").html()),0===d.length||-1!==c.toLowerCase().indexOf(d)})),e.empty().append(f),0!==f.length?(k(b),e.removeClass("hide").attr("aria-hidden","false"),b.setAttribute("aria-expanded","true")):(e.addClass("hide").attr("aria-hidden","true"),b.setAttribute("aria-expanded","false"))},j=function(a){var b=a.nextSibling;b.className+=" hide",b.innerHTML="",b.setAttribute("aria-hidden","true"),a.setAttribute("aria-expanded","false"),a.setAttribute("aria-activedescendent","")},k=function(b){var c=a(b),d=c.next();d.css({width:c.outerWidth(),left:c.position().left})},l=function(b,c){var d,e,f,g,h=c.target,k=h.nextSibling,l=-1!==k.className.indexOf("hide");if(32===b||b>47&&91>b||b>95&&112>b||b>159&&177>b||b>187&&223>b)c.altKey||i(h,h.value+String.fromCharCode(b));else if(8!==b||c.altKey){if((38===b||40===b)&&""===h.getAttribute("aria-activedescendent"))return l&&i(h),d=k.getElementsByTagName("a"),e=d[38===b?d.length-1:0],h.setAttribute("aria-activedescendent",e.parentNode.getAttribute("id")),a(e).trigger("focus.wb"),!1;l||(9===b||27===b||27===b&&!c.altKey)&&j(h)}else f=h.value,g=f.length,0!==g&&i(h,f.substring(0,g-1))},m=function(b,c){var d,e,f,g,h,k=c.parentNode.parentNode,l=k.previousSibling,m=a(l);return 32===b||b>47&&91>b||b>95&&112>b||b>159&&177>b||b>187&&223>b?(l.value+=String.fromCharCode(b),m.trigger("focus.wb"),i(l,l.value),!1):8===b?(f=l.value,g=f.length,0!==g&&(l.value=f.substring(0,g-1),i(l,l.value)),m.trigger("focus.wb"),!1):13===b?(d=c.getElementsByTagName("span"),f=d[0].innerHTML,0===f.length&&(f=d[1].innerHTML),l.value=f,m.trigger("focus.wb"),j(l),!1):9===b||27===b?(m.trigger("focus.wb"),j(l),!1):38===b||40===b?(38===b?(e=c.parentNode.previousSibling,e||(h=k.getElementsByTagName("li"),e=h[h.length-1])):(e=c.parentNode.nextSibling,e||(e=k.getElementsByTagName("li")[0])),e=e.getElementsByTagName("a")[0],l.setAttribute("aria-activedescendent",e.parentNode.getAttribute("id")),a(e).trigger("focus.wb"),!1):void 0},n=function(b){var c,d,e=b.nodeName.toLowerCase(),f="a"===e?b:b.parentNode,g=f.parentNode.parentNode,h=g.previousSibling,i=a(h);return c=f.getElementsByTagName("span"),d=c[0].innerHTML,0===d.length&&(d=c[1].innerHTML),h.value=d,i.trigger("focus.wb"),j(h),!1};f.on("timerpoke.wb keydown click vclick touchstart",e,function(a){var b=a.target,c=a.type,d=a.which;switch(c){case"timerpoke":h(a);break;case"keydown":if(!a.ctrlKey&&!a.metaKey)return l(d,a);break;case"click":case"vclick":case"touchstart":if(!d||1===d)return-1===b.nextSibling.className.indexOf("hide")?j(b):i(b,b.value),!1}return!0}),f.on("keydown click vclick touchstart",".wb-al a, .wb-al span",function(a){var b=a.target,c=a.type,d=a.which;switch(c){case"keydown":if(!a.ctrlKey&&!a.metaKey)return m(d,b);break;case"click":case"vclick":case"touchstart":if(!d||1===d)return n(b)}}),f.on("focusin text-resize.wb window-resize-width.wb window-resize-height.wb",function(b){var c,d,h,i,l,m="focusin"===b.type,n=b.target,o=n?n.id:null;if(g)for(c=f.find(e).get(),l=c.length,i=0;i!==l;i+=1)d=c[i],m?(h=d.nextSibling,-1!==h.className.indexOf("hide")||o===d.id||o===h.id||a.contains(h,n)||j(d)):k(d)}),b._timer.add(e)}(jQuery,window,document,vapour);